<mat-toolbar color="primary" class="header-toolbar">
  <div class="toolbar-content">
    <!-- Logo/Brand -->
    <div class="brand" routerLink="/products">
      <mat-icon>shopping_cart</mat-icon>
      <span class="brand-name">E-Commerce</span>
    </div>

    <!-- Spacer -->
    <span class="spacer"></span>

    <!-- Navigation & User Menu -->
    @if (currentUser(); as user) {
      <div class="nav-items">
        <!-- Products Link -->
        <button mat-button routerLink="/products" routerLinkActive="active-link">
          <mat-icon>inventory_2</mat-icon>
          <span class="nav-text">Products</span>
        </button>

        <!-- Admin Only: Add Product -->
        @if (isAdmin()) {
          <button mat-button routerLink="/products/new" routerLinkActive="active-link">
            <mat-icon>add_circle</mat-icon>
            <span class="nav-text">Add Product</span>
          </button>
        }

        <!-- User Menu Button - Visible for both Admin and Regular User -->
        <button 
          mat-button 
          [matMenuTriggerFor]="userMenu" 
          class="user-menu-btn"
          type="button"
          aria-label="User menu"
          [attr.aria-expanded]="menuOpen()"
        >
          <mat-icon>account_circle</mat-icon>
          <span class="user-info">
            <span class="user-name">{{ user.name }}</span>
            <span class="user-role" [class.admin-badge]="isAdmin()">
              {{ isAdmin() ? 'Admin' : 'Regular User' }}
            </span>
          </span>
          <mat-icon class="dropdown-icon" [class.rotated]="menuOpen()">arrow_drop_down</mat-icon>
        </button>

        <!-- User Dropdown Menu - Available for both Admin and Regular User -->
        <mat-menu 
          #userMenu="matMenu" 
          xPosition="before"
          yPosition="below"
          class="user-dropdown-menu"
          (closed)="onMenuClosed()"
          (opened)="onMenuOpened()"
        >
          <!-- Menu Header -->
          <div class="menu-header">
            <div class="menu-user-info">
              <mat-icon class="menu-user-icon">account_circle</mat-icon>
              <div class="menu-user-details">
                <div class="menu-user-name">{{ user.name }}</div>
                <div class="menu-user-email">{{ user.email }}</div>
                <div class="menu-user-role" [class.admin-role]="isAdmin()">
                  <mat-icon class="role-icon">{{ isAdmin() ? 'admin_panel_settings' : 'person' }}</mat-icon>
                  <span>{{ isAdmin() ? 'Admin' : 'Regular User' }}</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Divider -->
          <mat-divider></mat-divider>
          
          <!-- Logout Button - Available for both Admin and Regular User -->
          <button 
            mat-menu-item 
            (click)="logout($event)" 
            [disabled]="loggingOut()" 
            class="logout-menu-item"
            type="button"
            [attr.aria-disabled]="loggingOut()"
          >
            @if (loggingOut()) {
              <mat-icon>hourglass_empty</mat-icon>
              <span>Logging out...</span>
            } @else {
              <mat-icon>logout</mat-icon>
              <span>Logout</span>
            }
          </button>
        </mat-menu>
      </div>
    }
  </div>
</mat-toolbar>

