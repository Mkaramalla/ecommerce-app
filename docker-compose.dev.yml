version: '3.8'

services:
  mysql:
    ports:
      - "${MYSQL_PORT:-3307}:3306"
    command: --general-log=1 --general-log-file=/var/log/mysql/query.log
    volumes:
      - ./docker/mysql/logs:/var/log/mysql

  backend:
    build:
      target: development
      args:
        - INSTALL_XDEBUG=true
    volumes:
      - ./backend/laravel:/var/www/laravel
      - backend_vendor:/var/www/laravel/vendor
      - backend_cache:/var/www/laravel/storage/framework/cache
    environment:
      APP_ENV: local
      APP_DEBUG: "true"
      XDEBUG_MODE: debug
      XDEBUG_CONFIG: client_host=host.docker.internal

  nginx:
    volumes:
      - ./backend/laravel:/var/www/laravel

  frontend:
    build:
      target: development
    volumes:
      - ./frontend/ecommerce-ui:/app
      - frontend_node_modules:/app/node_modules
    command: npm run start -- --host 0.0.0.0 --port 4200
    environment:
      NODE_ENV: development

  redis:
    ports:
      - "6379:6379"

volumes:
  backend_vendor:
  backend_cache:
  frontend_node_modules:

